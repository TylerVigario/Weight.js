<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/mass.js | mass.js</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="JavaScript classes to convert imperial mass units as well as output and parse as text."><meta property="twitter:card" content="summary"><meta property="twitter:title" content="mass.js"><meta property="twitter:description" content="JavaScript classes to convert imperial mass units as well as output and parse as text."></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/MeekLogic/mass.js"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/mass.js~Mass.html">Mass</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-MassUnits">MassUnits</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/mass.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">  
/** 
 * Parsing and formatting imperial mass units.
 *
 * @author Tyler Vigario (MeekLogic)
 * @license GPL-3.0-only
 * @version 2.0.0
 */

import {MassUnits} from &apos;./massUnits&apos;;

/**
 * Class for working with string representations of mass.
 */
export default class Mass
{
    /**
     * Parse variable for Mass.
     * 
     * @param {(number|string)} text - Variable to parse for mass.
     * @returns {(number|false)} Returns mass represented in it&apos;s base imperial unit (pound) or false.
     * @see {@link Mass.parseUnit}
     */
    static parse(text)
    {
        if (typeof text === &apos;number&apos;) {
            // Value cannot be lower than zero
            if (text &lt; 0) {
                text = 0;
            }
            
            return text;
        }
        // We expect to parse a string
        else if (typeof text !== &apos;string&apos;) {
            return false;
        }

        // Remove all spaces
        text = text.replace(/\s/g, &apos;&apos;);

        // Remove all commas
        text = text.replace(&apos;,&apos;, &apos;&apos;);

        // Is string empty?
        if (text.length === 0) {
            return 0;
        }

        // Remove possible case sensitivity
        text = text.toLowerCase();

        // Find all signifiers within string
        let signifiers = Mass.findSignifiers(text);

        // Did we not find any signifiers?
        if (signifiers.length === 0) {
            return false;
        }

        // Extract individual unit for parsing
        let total = 0;
        let i = 0;
        signifiers.forEach((signifier) =&gt; {
            // Copy single unit from string
            let singleUnit = text.substring(i, signifier.splitAt);

            // Parse individual unit and add result to total
            total += Mass.parseUnit(singleUnit, MassUnits[signifier.unit]);

            // Set starting point for next search
            i = signifier.splitAt;
        });

        // Return total mass (as pounds)
        return total;
    }

    /**
     * Find mass unit signifiers within string.
     *
     * @param {string} text
     * @returns {array}
     */
    static findSignifiers(text) {
        // Find first signifier
        let signifiers = [];

        // Loop through MassUnits
        for (let MassUnit in MassUnits) {
            let signifier = -1;

            // Loop through each MassUnit&apos;s signifiers
            MassUnits[MassUnit].signifiers.forEach((s) =&gt; {
                // Look for signifier
                let o = text.indexOf(s);

                // Did we find signifier?
                if (o !== -1) {
                    // Since we want the index to represent the split BETWEEN units
                    // we will add the length of the signifier to include it
                    o = o + s.length;

                    // We want to find the first signifier in the string
                    if (signifier === -1 || o &gt; signifier.splitAt) {
                        signifier = {
                            unit: MassUnit,
                            signifier: s,
                            splitAt: o
                        };
                    }
                }
            });

            // We want to find the first signifier in the string
            if (signifier !== -1 ) {
                // Add only one (found) signifier per unit
                signifiers.push(signifier);
            }
        }

        // Sort ascending by splitAt index
        signifiers.sort((a, b) =&gt; {
            return a.splitAt - b.splitAt;
        });

        return signifiers;
    }

    /**
     * Parse string for single mass unit.
     * 
     * @param {string} text - String to parse for single mass unit.
     * @param {object} MassUnit
     * @returns {(number|false)} Returns mass represented in it&apos;s base imperial unit (pound) or false.
     */
    static parseUnit(text, MassUnit)
    {
        // Validate variable is of type string
        if (typeof text !== &apos;string&apos;) {
            return false;
        }

        // Pull number from string
        let mass = parseFloat(text);

        // Validate we were able to extract a number
        if (isNaN(mass)) {
            return false;
        }

        // Value cannot be lower than zero
        if (mass &lt; 0) {
            // Return lowest possible value
            return 0;
        }

        // Convert to base unit
        return mass / MassUnit.value;
    }

    /**
     * Format mass as text.
     * 
     * @param {number} pounds - Mass (represented as base unit pound) to format.
     * @param {boolean} [spaces = true] - Whether to add spaces between weight and signifier.
     * @param {number} [roundTo = 0] - The rounding to perform on the ounces.
     * @returns {string} Formatted mass string.
     */
    static format(pounds, spaces = true, roundTo = 0)
    {
        let formattedWeight = &apos;&apos;;
        
        // Convert pounds to ounces
        let ounces = pounds * 16;

        // Check if pounds is less than one
        if (pounds &lt; 1) {
            // Return formatted ounces only
            return ounces.toFixed(roundTo) + (spaces ? &apos; &apos; : &apos;&apos;) + &apos;oz&apos;;
        }

        // Floor pounds to remove change
        pounds = Math.floor(pounds);

        // Subtract ounces equal to whole pounds (leaving remaining ounces)
        ounces -= (pounds * 16);

        // Format pounds
        formattedWeight = pounds + (spaces ? &apos; &apos; : &apos;&apos;) + (pounds &gt; 1 ? &apos;lbs&apos; : &apos;lb&apos;);

        // Verify remaining ounces
        if (ounces &gt; 0) {
            // Format ounces
            formattedWeight += &apos; &apos; + ounces.toFixed(roundTo) + (spaces ? &apos; &apos; : &apos;&apos;) + &apos;oz&apos;;
        }

        return formattedWeight;
    }
}</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
